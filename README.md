üöÄ FastAPI Wallet API

**Production-ready –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞–º–∏ —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

üìñ –û –ø—Ä–æ–µ–∫—Ç–µ

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º. –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production-—Å—Ä–µ–¥–µ.

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ó–∞–ø—É—Å–∫ –∑–∞ 2 –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd fastapi_wallet_api

# –ó–∞–ø—É—Å—Ç–∏ –≤—Å—é —Å–∏—Å—Ç–µ–º—É
docker-compose up --build
```

**–ì–æ—Ç–æ–≤–æ!** –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞:
- üåê **API**: http://localhost:8000
- üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs

## üìö API Endpoints

### üí∞ –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞
```http
GET /api/v1/wallets/{wallet_id}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8000/api/v1/wallets/9038d0c3-832c-45af-88fb-66101dbd95d3"
```

**Response:**
```json
{
  "id": "9038d0c3-832c-45af-88fb-66101dbd95d3",
  "balance": 1500.50
}
```

### üí∏ –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (–î–µ–ø–æ–∑–∏—Ç/–°–Ω—è—Ç–∏–µ)
```http
POST /api/v1/wallets/{wallet_id}/operation
```

**–ü—Ä–∏–º–µ—Ä –¥–µ–ø–æ–∑–∏—Ç–∞:**
```bash
curl -X POST "http://localhost:8000/api/v1/wallets/9038d0c3-832c-45af-88fb-66101dbd95d3/operation" \
  -H "Content-Type: application/json" \
  -d '{"operation_type": "DEPOSIT", "amount": 1000}'
```

**–ü—Ä–∏–º–µ—Ä —Å–Ω—è—Ç–∏—è:**
```bash
curl -X POST "http://localhost:8000/api/v1/wallets/9038d0c3-832c-45af-88fb-66101dbd95d3/operation" \
  -H "Content-Type: application/json" \
  -d '{"operation_type": "WITHDRAW", "amount": 500}'
```

**Request:**
```json
{
  "operation_type": "DEPOSIT",
  "amount": 1000.00
}
```

**Response:**
```json
{
  "id": 1,
  "wallet_id": "9038d0c3-832c-45af-88fb-66101dbd95d3",
  "operation_type": "DEPOSIT",
  "amount": 1000.00,
  "created_at": "2024-01-15T12:00:00Z"
}
```

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó

- ‚úÖ **REST API** –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏** (SELECT FOR UPDATE)
- ‚úÖ **FastAPI + PostgreSQL** —Å—Ç–µ–∫
- ‚úÖ **–ü–æ–ª–Ω–∞—è Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic**
- ‚úÖ **PEP8 compliance**
- ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** (16 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger**

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: FastAPI + Python 3.10
- **Database**: PostgreSQL 13
- **ORM**: SQLAlchemy 2.0 + asyncpg
- **Migrations**: Alembic
- **Containerization**: Docker + Docker Compose
- **Testing**: pytest + async tests

## üîí –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç **race conditions** —Å –ø–æ–º–æ—â—å—é `SELECT FOR UPDATE`:

```python
# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
result = await session.execute(
    select(Wallet)
    .where(Wallet.id == wallet_id)
    .with_for_update()  # ‚ö° –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
)
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–æ–º—É –∫–æ—à–µ–ª—å–∫—É –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- ‚úÖ –ë–∞–ª–∞–Ω—Å –≤—Å–µ–≥–¥–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–π—Ç–∏ –≤ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
docker-compose --profile test up tests --build

# –†–µ–∑—É–ª—å—Ç–∞—Ç: 16/16 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ api/           # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã FastAPI
‚îú‚îÄ‚îÄ core/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ DB
‚îú‚îÄ‚îÄ crud/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ models/        # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ schemas/       # Pydantic —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ tests/         # –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
```

## üêõ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
docker-compose logs api      # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs postgres # –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
docker-compose down          # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down -v       # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–¥–∞–Ω–Ω—ã–µ –ë–î —É–¥–∞–ª—è—Ç—Å—è)
```

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- üí° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤** - –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- üí° **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - UUID, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã, –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
- üí° **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - 404, 400, 422, 500 —Å—Ç–∞—Ç—É—Å—ã
- üí° **Async/await** - –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

